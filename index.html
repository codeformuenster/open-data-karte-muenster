
<!DOCTYPE html>
<html>
<head>
    <title>Leaflet Layers Control Example</title>
    <meta charset="utf-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
        <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>
        <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>

    <style>
        body {padding: 0; margin: 0 }
        html, body, #map { height: 100% }

        .info {
            padding: 6px 8px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            background: white;
            background: rgba(255,255,255,0.8);
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-radius: 5px;
        }


        .info h4 {
            margin: 0 0 5px;
            color: #777;
        }

        .legend {
            text-align: left;
            line-height: 18px;
            color: #555;
        }
        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            opacity: 0.7;
        }
        @media (min-width: 800px) {
            .info { font-size:24px;line-height:26px;}
            .legend i {width: 26px;height: 26px;}


    </style>
</head>
<body>
    <div id="map"></div>

    <script type="text/javascript" src="maps/Ebene_2_Stadtteil.geojson.js"></script>
    <script type="text/javascript">


        var mapColors = ["#FFFFFF", "#FFF1D5", "#FFE4AB", "#FFD781", "#FFCA57", "#FFBD2E", "#EE9724", "#DE711B", "#CD4B12", "#BD2509", "#AD0000"]; 
        //["#FF0000", "#FE1C00", "#FD3800", "#FC5500", "#FB7100", "#FA8D00", "#F9AA00", "#F8C600", "#F7E200", "#F7FF00", "#FAFF33"];

        var dataSet = function() {

            var currentDataSet = 'haushalte';
            var currentSubSet = 6;

            var openData = {
                'haushalte': {
                    'title': 'Anzahl der Haushalte',
                    'unit': 'Haushalte',
                    'headlines': [ '','','2010','2011','2012','2013','2014' ],
                    'default': 6,
                    'limits' : [ 0, 1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000, 9000, 10000 ],
                    'data': { 
                        11 : ["Aegidii",,903,998,1001,995,959],
                        12 : ["Überwasser",,954,1073,1049,1054,1019],
                        13 : ["Dom",,1508,1642,1602,1611,1585],
                        14 : ["Buddenturm",,1401,1538,1546,1583,1589],
                        15 : ["Martini",,931,1017,1024,1025,1027],
                        21 : ["Pluggendorf",,2761,3079,3072,3098,3140],
                        22 : ["Josef",,5640,6046,6031,6227,6217],
                        23 : ["Bahnhof",,818,895,880,936,968],
                        24 : ["Hansaplatz",,4655,5015,5024,4981,5024],
                        25 : ["Mauritz-West",,3978,4257,4238,4252,4282],
                        26 : ["Schlachthof",,2856,3062,3101,3139,3145],
                        27 : ["Kreuz",,7678,8287,8266,8223,8235],
                        28 : ["Neutor",,2717,3159,3071,3004,3005],
                        29 : ["Schloss",,1185,1314,1295,1304,1303],
                        31 : ["Aaseestadt",,2990,3108,3132,3159,3121],
                        32 : ["Geist",,5093,5342,5328,5350,5411],
                        33 : ["Schützenhof",,4707,5063,5063,5148,5152],
                        34 : ["Düesberg",,3410,3485,3504,3543,3549],
                        43 : ["Hafen",,727,801,785,793,776],
                        44 : ["Herz-Jesu",,2759,2911,2926,2904,2956],
                        45 : ["Mauritz-Mitte",,5944,6181,6117,6211,6241],
                        46 : ["Rumphorst",,3990,4153,4212,4286,4265],
                        47 : ["Uppenberg",,4604,4990,5024,5079,5117],
                        51 : ["Gievenbeck",,8998,10170,10428,10661,10748],
                        52 : ["Sentrup",,3766,4339,4422,4451,4542],
                        54 : ["Mecklenbeck",,4407,4697,4206,4306,4570],
                        56 : ["Albachten",,2324,2414,2464,2504,2558],
                        57 : ["Roxel",,3953,4185,4254,4264,4336],
                        58 : ["Nienberge",,3196,3395,3391,3440,3433],
                        61 : ["Coerde",,4506,4673,4714,4791,4885],
                        62 : ["Kinderhaus-Ost",,2560,2623,2628,2649,2661],
                        63 : ["Kinderhaus-West",,4678,4905,4895,4913,4914],
                        68 : ["Sprakel",,1260,1269,1298,1332,1364],
                        71 : ["Mauritz-Ost",,5004,5200,5295,5343,5375],
                        76 : ["Gelmer-Dyckburg",,1536,1584,1625,1658,1682],
                        77 : ["Handorf",,3290,3421,3474,3476,3521],
                        81 : ["Gremmendorf-West",,2163,2215,2225,2367,2430],
                        82 : ["Gremmendorf-Ost",,2907,2978,3012,3080,3109],
                        86 : ["Angelmodde",,3528,3626,3655,3831,3857],
                        87 : ["Wolbeck",,3927,4025,4062,4137,4183],
                        91 : ["Berg Fidel",,2491,2580,2583,2586,2614],
                        95 : ["Hiltrup-Ost",,2968,3016,2986,2995,3014],
                        96 : ["Hiltrup-Mitte",,4947,5093,5150,5164,5166],
                        97 : ["Hiltrup-West",,3938,4083,4174,4208,4278],
                        98 : ["Amelsbüren",,2322,2384,2422,2439,2426]
                    }
                }
            };





            function getTitle() { return openData[currentDataSet].title; }
            function getUnit() { return openData[currentDataSet].unit; }
            function getLimits() { return openData[currentDataSet].limits}
            function getDataItem( stadtteilNr ) {
                return openData[currentDataSet]['data'][stadtteilNr][currentSubSet];
            }
            function getDataItemColor( stadtteilNr ) {
                var currentVal = getDataItem( stadtteilNr );
                var a = getLimits();
                var len = a.length;
                var currentNr = len-1;
                for (var i = 0; i < len; i++ ) {
                  if ( currentVal <= a[i] ) {
                    currentNr = i-1;
                    break;
                  }
                }
                return mapColors[currentNr]
            }

            return {
                getUnit:getUnit,
                getTitle:getTitle,
                getLimits:getLimits,
                getDataItem:getDataItem,
                getDataItemColor:getDataItemColor
            }
        }();

        function getColor( i ) {
            return mapColors[i];
        }

        var map = L.map('map').setView([ 51.962, 7.629], 11);

        L.tileLayer(
            'http://{s}.tiles.mapbox.com/v3/tomrocket.m8l1e9gm/{z}/{x}/{y}.png', {
                maxZoom: 20,
                attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                    '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                    'Imagery © <a href="http://mapbox.com">Mapbox</a>',                 
            }
        ).addTo(map);


        // control that shows state info on hover
        var info = L.control();

        info.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'info');
            this.update();
            return this._div;
        };

        info.update = function (props) {
            var html = '<h4>'+ dataSet.getTitle() +'</h4>';
            html = html +  (props ?
                '<b>' + props.Name + '</b><br />' + dataSet.getDataItem( props.Nr ) +' '+ dataSet.getUnit() + ' '
                : 'Navigieren Sie über einen Stadtteil');


            this._div.innerHTML = html;


        };

        info.addTo(map);



        function style(feature) {
            return {
                weight: 2,
                opacity: 1,
                color: 'white',
                dashArray: '3',
                fillOpacity: 0.7,
                fillColor: dataSet.getDataItemColor( feature.properties.Nr )  
            };
        }

        function highlightFeature(e) {
            var layer = e.target;

            layer.setStyle({
                weight: 5,
                color: '#666',
                dashArray: '',
                fillOpacity: 0.7
            });

            if (!L.Browser.ie && !L.Browser.opera) {
                layer.bringToFront();
            }

            info.update(layer.feature.properties);
        }

        var geojson;

        function resetHighlight(e) {
            geojson.resetStyle(e.target);
            info.update();
        }

        function zoomToFeature(e) {
            map.fitBounds(e.target.getBounds());
        }

        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: zoomToFeature
            });
        }

        geojson = L.geoJson(stadtteileMuenster2, {
            style: style,
            onEachFeature: onEachFeature
        }).addTo(map);

        map.attributionControl.addAttribution('Jahresstatistiken &copy; <a href="http://www.muenster.de/stadt/stadtplanung/zahlen.html">Stadt Münster</a>');


        var legend = L.control({position: 'bottomright'});

        legend.onAdd = function (map) {

            var div = L.DomUtil.create('div', 'info legend'),
                grades = dataSet.getLimits(),
                labels = [],
                from, to;

            for (var i = 0; i < grades.length; i++) {
                from = grades[i];
                to = grades[i + 1];

                labels.push(
                    '<i style="background:' + getColor(i) + '"></i> ' +
                    from + (to ? '&ndash;' + to : '+'));
            }

            div.innerHTML = labels.join('<br>');
            return div;
        };

        legend.addTo(map);

    </script>
</body>
</html>
